# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: Pod
metadata:
  name: bench-client
  labels:
    app: bench-client
spec:
  restartPolicy: Never
  containers:
  - name: benchmark
    image: python:3.10
    workingDir: /workspace
    command: ["/bin/bash", "-c"]
    # This script runs ONCE when the pod starts to set everything up.
    # Then it sleeps forever so the pod stays open for you.
    args:
    - |
      echo "--- STARTING SETUP ---"

      # 1. Install Git
      apt-get update && apt-get install -y git

      # 2. Install Python Dependencies
      pip install -q transformers aiohttp numpy requests tqdm pandas datasets Pillow

      # 3. Clone the Repo (Specific Branch)
      echo "Cloning repo..."
      git clone --single-branch --branch ishan/sa-1.1-sgl-dsr1-fp8 https://github.com/ai-dynamo/dynamo.git /workspace/dynamo

      echo "--- SETUP COMPLETE. POD IS READY. ---"

      # 4. Keep the pod alive indefinitely
      sleep infinity
